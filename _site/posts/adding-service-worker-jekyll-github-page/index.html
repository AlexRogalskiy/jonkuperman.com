<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jon Kuperman&#39;s Personal Blog</title>
    <meta name="Description" content="My personal website and blog.">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jon Kuperman&#39;s Personal Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Jon Kuperman&#39;s Personal Blog</a></h1>
      <ul class="nav"><li class="nav-item"><a href="/">Home</a></li><li class="nav-item"><a href="/posts/">Archive</a></li><li class="nav-item"><a href="/about/">About</a></li></ul>
    </header>

    <main class="tmpl-post">
      <h1>Adding a Service Worker to a Jekyll blog hosted on GitHub Pages</h1>

<p>I need to refresh my blog!</p>
<blockquote>
<p>...famous last words</p>
</blockquote>
<p>After a few days of researching all the latest and greatest technology, I ended up back where I started. Running a <a href="https://jekyllrb.com/">Jekyll</a> blog on <a href="https://pages.github.com/">GitHub Pages</a>. Although there are a lot of great options out there, I'm pretty lazy, and this approach still works great!</p>
<p>One thing I was excited about with an alternative like <a href="https://www.gatsbyjs.org/">Gatsby</a> or <a href="https://nextjs.org/">Next.js</a> was taking advantage of some of the new web APIs like <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Service Workers</a> and <a href="https://developers.google.com/web/fundamentals/web-app-manifest/">Manifest</a> files. Luckily I found a <a href="https://github.com/lavas-project/jekyll-pwa">great looking plugin</a> which generates Service Workers for you!</p>
<h2 id="not-so-fast">Not So Fast <a class="direct-link" href="#not-so-fast" aria-hidden="true">#</a></h2>
<p>I installed the PWA plugin, configured it, and noticed it running smoothly in development! It couldn't have been easier. Unfortunately, when I went to deploy it to production, I didn't see the Service Worker, and the app was not available offline!</p>
<p>It seems like while GitHub pages host Jekyll sites easily, they run Jekyll in &quot;safe mode&quot; which disallows the use of many plugins. Back to the drawing board.</p>
<p>My next thought was to check out <a href="https://developers.google.com/web/tools/workbox/">Workbox</a>. Workbox is an initiative by the folks at Google to make Service Worker generation and customization easy.</p>
<p>I've used Workbox before with JS heavy apps alongside build tools like Gulp and Webpack. The integration with these build tools is seamless, but they didn't have a clean option for Jekyll.</p>
<h2 id="introducing-workbox-cli!">Introducing workbox-cli! <a class="direct-link" href="#introducing-workbox-cli!" aria-hidden="true">#</a></h2>
<p>Workbox provides an <a href="https://developers.google.com/web/tools/workbox/modules/workbox-cli">out of the box solution</a> for apps that don't use Webpack or Gulp. It's a standalone CLI app that can be installed with <code>npm install workbox-cli -g</code> and then used with a command like <code>workbox wizard</code>. The wizard generates a workbox-config.js file which then can be used to generate a service-worker.js file. Here is my lightweight configuration:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  globDirectory<span class="token punctuation">:</span> <span class="token string">"./_site"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  globPatterns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"**/*.{html,css,png,ico,xml,json,js}"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  swDest<span class="token punctuation">:</span> <span class="token string">"./sw.js"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p>Which generates something like this:</p>
<pre class="language-json"><code class="language-json"><span class="token comment">/**<br><span class="highlight-line"> * Welcome to your Workbox-powered service worker!</span><br><span class="highlight-line"> *</span><br><span class="highlight-line"> * You'll need to register this file in your web app and you should</span><br><span class="highlight-line"> * disable HTTP caching for this file too.</span><br><span class="highlight-line"> * See https://goo.gl/nhQhGp</span><br><span class="highlight-line"> *</span><br><span class="highlight-line"> * The rest of the code is auto-generated. Please don't update this file</span><br><span class="highlight-line"> * directly; instead, make changes to your Workbox build configuration</span><br><span class="highlight-line"> * and re-run your build process.</span><br><span class="highlight-line"> * See https://goo.gl/2aRDsh</span><br> */</span><br><span class="highlight-line"></span><br><span class="highlight-line">importScripts(<span class="token string">"https://storage.googleapis.com/workbox-cdn/releases/3.6.3/workbox-sw.js"</span>);</span><br><span class="highlight-line"></span><br><span class="token comment">/**<br><span class="highlight-line"> * The workboxSW.precacheAndRoute() method efficiently caches and responds to</span><br><span class="highlight-line"> * requests for URLs in the manifest.</span><br><span class="highlight-line"> * See https://goo.gl/S9QRab</span><br> */</span><br><span class="highlight-line">self.__precacheManifest = <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"2018/11/18/content-is-not-sized-correctly-for-the-viewport.html"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"b8296e61e61b180e1b4f7606c332d27a"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"2018/11/18/getting-started-with-asts.html"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"9a7f7ec5aee1b59c98179f4eee0c4051"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"css/style.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"5a5ff92978aed905a5cfcd43acdd3ed1"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"favicon-16x16.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"c11b060a3fc097bb5dfa397801696181"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"favicon-32x32.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"4106c0929ea4e86af8b4c32b3c5cb005"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"favicon-96x96.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"258c7595bce80a8c608e51ae227d84eb"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"favicon.ico"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"b4edcd8aecd2b771aec9a39cb032f740"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"feed.xml"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"a4e7f5bdfb297a383c7e6e513abdb5a8"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"google115b0b3efae5b385.html"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"4be3d71ff251a338c77a1e0d2e263e53"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-128x128.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"406286c197ab21ec8bfc84bef3bbfd92"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-144x144.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"05d0ef9821328286268e681a4edb649d"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-152x152.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"5319ce81e0070ed214e0904053d91a43"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-192x192.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"6738ac38beff3020bc1478994b6b1dd1"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-384x384.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"2bd87bce217800ce8611c965b4e16c5c"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-512x512.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"068ef79122e182e250ea12d541204655"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-72x72.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"efe5da2908f53b6704e8e31a5691c6c0"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"images/icons/icon-96x96.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"d992f5f38ea810ae6d062138b3070909"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"4a2eab3f48167712ece3bdaea38f88bf"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"manifest.json"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"cf78eefd76455d552c13a40594d9476c"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"workbox-config.js"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"revision"</span><span class="token operator">:</span> <span class="token string">"5a236654f477f68ae3829b7f219715db"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">]</span>.concat(self.__precacheManifest || <span class="token punctuation">[</span><span class="token punctuation">]</span>);</span><br><span class="highlight-line">workbox.precaching.suppressWarnings();</span><br><span class="highlight-line">workbox.precaching.precacheAndRoute(self.__precacheManifest<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>);</span></code></pre>
<p>The specific thing to note (which makes this work well with Jekyll) is that Workbox gathers its list of files from the generated _site/ directory. If Workbox wrote the sw.js file to that directory it would just get deleted on the next Jekyll serve. Instead it reads from _site/ and writes to ./ so that the generated file will be put back in _site/ by Jekyll serve.</p>
<p>Does anyone have a better approach?</p>


<p><a href="/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /posts/adding-service-worker-jekyll-github-page/ -->
  </body>
</html>
